<?php
/*
                   :....................,:,              
                ,.`,,,::;;;;;;;;;;;;;;;;:;`              
              `...`,::;:::::;;;;;;;;;;;;;::'             
             ,..``,,,::::::::::::::::;:;;:::;            
            :.,,``..::;;,,,,,,,,,,,,,:;;;;;::;`          
           ,.,,,`...,:.:,,,,,,,,,,,,,:;:;;;;:;;          
          `..,,``...;;,;::::::::::::::'';';';:''         
          ,,,,,``..:;,;;:::::::::::::;';;';';;'';        
         ,,,,,``....;,,:::::::;;;;;;;;':'''';''+;        
         :,::```....,,,:;;;;;;;;;;;;;;;''''';';';;       
        `,,::``.....,,,;;;;;;;;;;;;;;;;'''''';';;;'      
        :;:::``......,;;;;;;;;:::::;;;;'''''';;;;:       
        ;;;::,`.....,::;;::::::;;;;;;;;'''''';;,;;,      
        ;:;;:;`....,:::::::::::::::::;;;;'''':;,;;;      
        ';;;;;.,,,,::::::::::::::::::;;;;;''':::;;'      
        ;';;;;.;,,,,::::::::::::::::;;;;;;;''::;;;'      
        ;'';;:;..,,,;;;:;;:::;;;;;;;;;;;;;;;':::;;'      
        ;'';;;;;.,,;:;;;;;;;;;;;;;;;;;;;;;;;;;:;':;      
        ;''';;:;;.;;;;;;;;;;;;;;;;;;;;;;;;;;;''';:.      
        :';';;;;;;::,,,,,,,,,,,,,,:;;;;;;;;;;'''';       
         '';;;;:;;;.,,,,,,,,,,,,,,,,:;;;;;;;;'''''       
         '''';;;;;:..,,,,,,,,,,,,,,,,,;;;;;;;''':,       
         .'''';;;;....,,,,,,,,,,,,,,,,,,,:;;;''''        
          ''''';;;;....,,,,,,,,,,,,,,,,,,;;;''';.        
           '''';;;::.......,,,,,,,,,,,,,:;;;''''         
           `''';;;;:,......,,,,,,,,,,,,,;;;;;''          
            .'';;;;;:.....,,,,,,,,,,,,,,:;;;;'           
             `;;;;;:,....,,,,,,,,,,,,,,,:;;''            
               ;';;,,..,.,,,,,,,,,,,,,,,;;',             
                 '';:,,,,,,,,,,,,,,,::;;;:               
                  `:;'''''''''''''''';:.                 
                                                         
 ,,,::::::::::::::::::::::::;;;;,::::::::::::::::::::::::
 ,::::::::::::::::::::::::::;;;;,::::::::::::::::::::::::
 ,:; ## ## ##  #####     ####      ## ## ##  ##   ##  ;::
 ,,; ## ## ##  ## ##    ##         ## ## ##  ##   ##  ;::
 ,,; ## ## ##  ##  ##  ##   ####   ## ## ##   ## ##   ;::
 ,,' ## ## ##  ## ##    ##    ##   ## ## ##   ## ##   :::
 ,:: ########  ####      ######    ########    ###    :::
 ,,,:,,:,,:::,,,:;:::::::::::::::;;;:::;:;:::::::::::::::
 ,,,,,,,,,,,,,,,,,,,,,,,,:,::::::;;;;:::::;;;;::::;;;;:::
                                                         
	     (c) WDGWV. 2013, http://www.wdgwv.com           
	 websites, Apps, Hosting, Services, Development.      

  File Checked.
  Checked by: WdG.
  File created: WdG.
  date: 07-06-2013

  © WDGWV, www.wdgwv.com
  All Rights Reserved.
*/

// NOT FOR PUBLIC !!!
set_time_limit(0);
ignore_user_abort(1);

echo 'ok here we\'ll go';

$debug = false;

$setup = "WDGWV SetupFile

WDGWV Setup 1.0
© WDGWV 2013, http://www.wdgwv.com

WDGWV CMS~3.0
http://www.wdgss.nl

";

$fileVer = '1.1';

function ParseDir($dir)
{
	global $setup, $fileVer, $debug;

	$oDir = opendir($dir);

	while ( false !== ( $file = readdir ( $oDir ) ) )
	{
		if ( substr($file, 0, 1) != '.' )
		{
			if ( !is_dir ( $dir . '/' . $file ) )
			{
				//echo Pack it :D
				$tDir   = $dir;
				$tDir   = preg_replace("/\.\.\//", ".", $tDir);
				$ext    = explode(".", $file);
				$ext    = $ext[sizeof($ext)-1];

				if ( $ext != 'version')
				{
					if ($debug)
						$setup .= "{$tDir}/{$file}~{$fileVer}~".file_get_contents($dir . '/' . $file)."\r\n";
					else
						$setup .= base64_encode($tDir."/".$file) . "~" . base64_encode($fileVer) . "~" . base64_encode(file_get_contents($dir . '/' . $file)) . "\r\n";
				}
			}
			else
			{
				if ( $file != '..' && $file != 'tests' )
				{
					$tDir   = $dir;
					$tDir   = preg_replace("/\.\.\//", ".", $tDir);

					$setup .= "~~{$tDir}/{$file}\r\n";
					ParseDir($dir . '/' . $file);
				}
			}
		}
	}
}

ParseDir('../');
//echo $setup;
file_put_contents('test.txt', gzcompress($setup));
?>